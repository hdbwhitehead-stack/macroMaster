Sub Auto_Open()
    Application.OnKey "^+0", "BalanceAutomation"
    Application.OnKey "^+k", "forecast_Border"
    Application.OnKey "^+j", "pFill"
    Application.OnKey "^+d", "dateActual"
    Application.OnKey "^+i", "circClear"
    Application.OnKey "^+z", "OpenActivateDialog"
    Application.OnKey "^+v", "centAcrSel"
    Application.OnKey "^+n", "minusMult"
    Application.OnKey "^+e", "if_Error"
    Application.OnKey "^+'", "topBold"
    Application.OnKey "^+w", "Zoom"
    
End Sub

Public Sub BalanceAutomation()
    Dim sel As Range
    Set sel = Selection
    
    Dim nRows As Long, nCols As Long
    nRows = sel.Rows.Count
    nCols = sel.Columns.Count
    Dim borderColor As Long
    Dim interior As Range
    Dim bRow As Range
    
    Set interior = sel.Range(Cells(2, 1), Cells(nRows - 1, nCols))
    interior.FillRight
    
    Set bRow = sel.Range(Cells(nRows, 1), Cells(nRows, nCols))
    borderColor = RGB(192, 0, 0)
    bRow.Font.Bold = True
    
    With bRow.Borders(xlEdgeTop)
        .Weight = xlThin
        .Color = borderColour
    End With
    
    Dim c As Long
    For c = 1 To nCols
        sel.Cells(1, c).FormulaR1C1 = "=R[" & (nRows - 1) & "]C[-1]"
        If nRows > 2 Then
            sel.Cells(nRows, c).FormulaR1C1 = "=SUM(R[" & (-nRows + 1) & "]C:R[-1]C)"
        Else
            sel.Cells(nRows, c).FormulaR1C1 = "=RC"
        End If
    Next c
End Sub

Public Sub forecast_Border()

    Dim Rng As Range
    Set Rng = Selection
    Dim borderColor As Long
    
    borderColor = RGB(192, 0, 0)
    
    With Rng.Borders(xlEdgeRight)
        .LineStyle = xlDash
        .Color = borderColor
        .Weight = xlThin
    End With
    
End Sub

Public Sub pFill()

Dim pRng As Range
Set pRng = Selection
    With pRng.interior
        .Pattern = xlPatternGray16
        .PatternColorIndex = xlAutomatic
        .Color = RGB(255, 255, 255)
        .PatternTintAndShade = 0
    End With
End Sub

Public Sub dateActual()

    Dim dRange As Range
    Set dRange = Selection
    Dim nCols As Long
    
    nCols = dRange.Columns.Count
    dRange.HorizontalAlignment = xlCenter
    
    For r = 1 To nCols
        If dRange.Cells(1, r) < Date Then
            dRange.Cells(1, r).NumberFormat = """FY""yy""A"""
        Else
            dRange.Cells(1, r).NumberFormat = """FY""yy""F"""
        End If
    Next r
        

End Sub


Sub circClear()

    Dim usrChoice As Integer
    usrChoice = MsgBox("Do you want to switch iterations/circularity on?", vbYesNo + vbQuestion, "Turn Circularity/Iterations on?")
    
    If usrChoice = vbYes Then
        
        Range("circ").Value = 1
        
        With Application
            .Iteration = True ' Enable iterative calculation
            .MaxIterations = 100 ' Set maximum iterations to 100
            .MaxChange = 0.0001 ' Set maximum change to 0.0001
        End With
    MsgBox "Iterative calculations are now enabled and the circ switch is on"

    Else
        Range("circ").Value = 0
        With Application
            .Iteration = False
            .MaxIterations = 100
            .MaxChange = 0.0001
        End With
        MsgBox "Iterative calculations are now disabled and the circ switch is off"
    End If

    
End Sub

Public Sub OpenActivateDialog()
   With Application.CommandBars("Workbook Tabs")
      'MODIFY THE STRING "More Sheets..." to submit your local
      If .Controls(.Controls.Count).Caption = "More Sheets..." Then
          .Controls(.Controls.Count).Execute
      Else
          .ShowPopup
      End If
   End With
End Sub

Sub centAcrSel()

    With Selection
        .HorizontalAlignment = xlCenterAcrossSelection
    End With
End Sub

Sub minusMult()
    Dim tempCell As Range
    Set tempCell = ActiveSheet.Cells(Rows.Count, Columns.Count).End(xlUp).Offset(1, 0)
    tempCell.Value = -1
    tempCell.Copy
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlMultiply, SkipBlanks:=False, Transpose:=False
    Application.CutCopyMode = False
    tempCell.Clear
End Sub

Sub if_Error()
    Dim cell As Range
    Dim formulaText As String
    Dim innerFormula As String
    For Each cell In Selection.Cells
        If cell.HasFormula Then
            formulaText = cell.Formula
            If Left(formulaText, 9) = "=IFERROR(" Then
                Dim closeParen As Long
                closeParen = Len(formulaText)
                Dim firstComma As Long
                firstComma = InStrRev(formulaText, ",")
                innerFormula = Mid(formulaText, 10, firstComma - 10)
                cell.Formula = "=" & innerFormula
            Else
                cell.Formula = "=IFERROR(" & Mid(formulaText, 2) & ",""N/A"")"
            End If
        End If
    Next cell
End Sub
            
Sub topBold()
    With Selection.Borders(xlEdgeTop)
        .Weight = xlThin
        .Color = borderColour
    End With
    Selection.Font.Bold = True
End Sub

Sub Zoom()
    Dim ws As Worksheet
    Dim firstSheet As Worksheet
    Application.ScreenUpdating = False
    Set firstSheet = ThisWorkbook.Worksheets(1)
    
    For Each ws In ActiveWorkbook.Sheets
        ws.Activate
        ws.[a1].Select
        ActiveWindow.Zoom = 100
        ActiveWindow.DisplayGridlines = False
    Next ws
    Application.ScreenUpdating = True
    firstSheet.Activate
End Sub
